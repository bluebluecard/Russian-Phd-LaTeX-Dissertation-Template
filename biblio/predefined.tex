%%% Bibliography implementation with built-in BibTeX8 backend %%%

%%% Packages %%%
\usepackage{cite}                                   % Better-looking bibliography citations


%%% Styles %%%
\bibliographystyle{BibTeX-Styles/utf8gost71u}    % Format bibliography according to GOST 7.1 (GOST R 7.0.11-2011, 5.6.7)

\makeatletter
\renewcommand{\@biblabel}[1]{#1.}   % Replace square-bracket bibliography labels with a trailing dot
\makeatother
%% Control spacing between entries
%% requires etoolbox
%% http://tex.stackexchange.com/a/105642
%\patchcmd\thebibliography
% {\labelsep}
% {\labelsep\itemsep=5pt\parsep=0pt\relax}
% {}
% {\typeout{Couldn't patch the command}}

%%% Bibliography list with first-line indent (no hanging indent) %%%
%\patchcmd{\thebibliography} % may require enabling the etoolbox package
%  {\advance\leftmargin\labelsep}
%  {\leftmargin=0pt%
%   \setlength{\labelsep}{\widthof{\ }}% Controls spacing after the dot
%   \itemindent=\parindent%
%   \addtolength{\itemindent}{\labelwidth}% Shift right by label width including dot
%   \advance\itemindent\labelsep%
%  }
%  {}{}

%%% Citations %%%
\renewcommand\citepunct{;\penalty\citepunctpenalty%
    \hskip.13emplus.1emminus.1em\relax}                % Use ; as separator in citation lists (GOST R 7.0.5-2008)

\newcommand*{\autocite}[1]{}  % Prevent biblatex-oriented citation examples from failing in bibtex mode

%%% Commands for bibliography output %%%
\newcommand*{\insertbibliofull}{
\bibliography{biblio/external,biblio/author}         % Connect BibTeX databases. Do not add spaces after commas: BibTeX treats them as part of the path.
}

\newcommand*{\insertbiblioauthor}{
\bibliography{biblio/author}         % Connect BibTeX databases. Do not add spaces after commas: BibTeX treats them as part of the path.
}

\newcommand*{\insertbiblioexternal}{
\bibliography{biblio/external}         % Connect BibTeX databases
}


%% Counter for used bibliography entries that handles repeated citations
%% Requires two compilations to read the up-to-date external bibliography list file
\newtotcounter{citenum}
\def\oldcite{}
\let\oldcite=\bibcite
\def\bibcite{\stepcounter{citenum}\oldcite}
