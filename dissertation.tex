%&preformat-disser
\RequirePackage[l2tabu,orthodox]{nag} % Uncomment to get recommendations on proper package usage and warnings about outdated/discouraged packages in the log
% A4 format, 14pt (GOST R 7.0.11-2011, 5.3.6)
\documentclass[a4paper,14pt,oneside,openany]{memoir}

\input{common/setup}            % shared template settings
\input{common/packages}         % packages shared by dissertation and synopsis
\synopsisfalse                      % This document is not the synopsis
\input{Dissertation/dispackages}    % dissertation-specific packages
\input{Dissertation/userpackages}   % packages for custom user tasks

\input{Dissertation/setup}      % simplified template settings

\input{common/newnames}         % new variables for the whole project

\input{common/data}             % core metadata
\input{common/fonts}            % font definitions (partial)
\input{common/styles}           % styles shared by dissertation and synopsis
\input{Dissertation/disstyles}  % dissertation-specific styles
\input{Dissertation/userstyles} % styles for custom user tasks

%%% Bibliography backend selection %%%
% Only the selected key is checked here. Backend selection settings
% are configured in common/setup.tex
\ifnumequal{\value{bibliosel}}{0}{%
    \input{biblio/predefined}   % Built-in implementation with loading via the bibtex8 engine
}{
    \input{biblio/biblatex}     % biblatex implementation via the biber engine
}

% Print selected options to the build log
\typeout{Selected options:}
\typeout{Draft mode: \arabic{draft}}
\typeout{Font: \arabic{fontfamily}}
\typeout{AltFont: \arabic{usealtfont}}
\typeout{Bibliography backend: \arabic{bibliosel}}
\typeout{Precompile images: \arabic{imgprecompile}}
% Print versions of used libraries to the build log
\listfiles

%%% Compile control for individual dissertation parts %%%
% First compile the full document once so all
% intermediate files are available
% Then use the \includeonly command to output selected parts
% Examples:
%
%\includeonly{Dissertation/part2}
%\includeonly{Dissertation/contents,Dissertation/appendix,Dissertation/conclusion}
%
% If all commands are commented out, the full document is produced as PDF

\begin{document}
%%% Rename standard section titles
% https://tex.stackexchange.com/a/156050
\gappto\captionsrussian{\input{common/renames}} % for polyglossia and babel
\input{common/renames}
\gappto\captionsrussian{\input{Dissertation/renames}} % for polyglossia and babel
\input{Dissertation/renames}

%%% Dissertation structure (GOST R 7.0.11-2011, section 4)
\include{Dissertation/title}           % Title page
\include{Dissertation/contents}        % Table of contents
\ifnumequal{\value{contnumfig}}{1}{}{\counterwithout{figure}{chapter}}
\ifnumequal{\value{contnumtab}}{1}{}{\counterwithout{table}{chapter}}
\include{Dissertation/introduction}    % Introduction
\ifnumequal{\value{contnumfig}}{1}{\counterwithout{figure}{chapter}
}{\counterwithin{figure}{chapter}}
\ifnumequal{\value{contnumtab}}{1}{\counterwithout{table}{chapter}
}{\counterwithin{table}{chapter}}
\include{Dissertation/part1}           % Chapter 1
\include{Dissertation/part2}           % Chapter 2
\include{Dissertation/part3}           % Chapter 3
\include{Dissertation/conclusion}      % Conclusion
\include{Dissertation/acronyms}        % List of abbreviations and notation
\include{Dissertation/dictionary}      % Glossary
\include{Dissertation/references}      % References
\include{Dissertation/lists}           % Lists of tables and figures (illustrative material)

\setcounter{totalchapter}{\value{chapter}} % Count number of chapters

%%% Appendix settings
\appendix
% Format appendix headings closer to GOST style:
\setlength{\midchapskip}{20pt}
\renewcommand*{\afterchapternum}{\par\nobreak\vskip \midchapskip}
\renewcommand\thechapter{\Asbuk{chapter}} % Use Russian letters for appendix numbering

\include{Dissertation/appendix}        % Appendices

\setcounter{totalappendix}{\value{chapter}} % Count number of appendices

\end{document}
